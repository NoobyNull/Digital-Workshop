# Security Scanning Configuration for Digital Workshop
# This file configures various security scanning tools used in CI/CD pipeline

# Bandit Configuration (Python Static Analysis)
bandit:
  # Exclude tests from security scanning
  exclude_dirs:
    - "tests/"
    - "test/"
    - "build/"
    - "dist/"
  
  # Security tests to run
  tests:
    - "B101"  # assert_used
    - "B102"  # exec_used
    - "B103"  # set_bad_file_permissions
    - "B104"  # hardcoded_bind_all_interfaces
    - "B105"  # hardcoded_password_default
    - "B106"  # hardcoded_password_funcarg
    - "B107"  # hardcoded_password_default
    - "B108"  # hardcoded_tmp_directory
    - "B110"  # try_except_pass
    - "B112"  # try_except_continue
    - "B201"  # flask_debug_true
    - "B301"  # pickle
    - "B302"  # marshal
    - "B303"  # md5
    - "B304"  # ciphers
    - "B305"  # ciphers_no_integrity
    - "B306"  # mktemp_q
    - "B307"  # eval
    - "B308"  # mark_safe
    - "B310"  # urllib_urlopen
    - "B311"  # urllib_urlopen_without_cert_validation
    - "B312"  # telnetlib
    - "B313"  # xml_bad_cdata
    - "B314"  # xml_bad_entity
    - "B315"  # xml_bad_element
    - "B316"  # xml_external_entity
    - "B317"  # xml_dtd_entity
    - "B318"  # xml_dtd_not_secure
    - "B319"  # xml_invalid_entity
    - "B320"  # xml_invalid_comment
    - "B321"  # xml_invalid_dtd
    - "B322"  # xml_external_entity_default
    - "B323"  # unverified_context
    - "B324"  # hashlib_new_insecure
    - "B325"  # tempnam
    - "B401"  # import_telnetlib
    - "B402"  # import_ftplib
    - "B403"  # import_pickle
    - "B404"  # import_subprocess
    - "B405"  # import_xml_etree
    - "B406"  # import_xmlrpc
    - "B407"  # import_xmlrpc
    - "B408"  # import_http_client
    - "B409"  # import_urllib_request
    - "B410"  # import_urllib_urlopen
    - "B411"  # import_xmlrpc
    - "B412"  # import_ftplib
    - "B413"  # import_pycrypto
    - "B413"  # import_pycryptodome
    - "B419"  # import_pyyaml
    - "B420"  # eval_with_match
    - "B421"  # eval_with_literal
    - "B422"  # eval_with_literal_compile
    - "B423"  # eval_with_literal_exec
    - "B424"  # eval_with_literal_format
    - "B425"  # eval_with_literal_sanitize
    - "B426"  # eval_with_literal_decompile
    - "B427"  # eval_with_literal_marshal
    - "B428"  # eval_with_literal_byte_compile
    - "B429"  # eval_with_literal_compile
    - "B430"  # ssl_with_bad_version
    - "B432"  # ssl_with_no_version
    - "B433"  # ssl_with_bad_defaults
    - "B434"  # ssl_with_bad_version
    - "B435"  # ssl_with_bad_ciphers
    - "B436"  # ssl_with_bad_options
    - "B437"  # ssl_with_bad_version
    - "B438"  # ssl_with_bad_defaults
    - "B439"  # ssl_with_bad_ciphers
    - "B440"  # ssl_with_bad_options
    - "B441"  # import_cffi
    - "B442"  # import_cryptography_no_version
    - "B443"  # import_cryptography
    - "B444"  # import_cryptography_no_pad
    - "B445"  # import_cryptography_no_sign
    - "B446"  # import_cryptography_no_key
    - "B447"  # import_cryptography_no_cert
    - "B448"  # import_cryptography_no_cert_verification
    - "B449"  # import_cryptography_no_sign_and_verify
    - "B450"  # import_cryptography_no_key_and_cert
    - "B451"  # import_cryptography_no_serialization
    - "B452"  # import_cryptography_no_ecdh
    - "B453"  # import_cryptography_no_dsa
    - "B454"  # import_cryptography_no_ecdsa
    - "B455"  # import_cryptography_no_dh
    - "B456"  # import_cryptography_no_aes
    - "B457"  # import_cryptography_no_aes_ctr
    - "B458"  # import_cryptography_no_aes_cbc
    - "B459"  # import_cryptography_no_aes_gcm
    - "B460"  # import_cryptography_no_ecdh
    - "B461"  # import_cryptography_no_ecdsa
    - "B462"  # import_cryptography_no_dsa
    - "B463"  # import_cryptography_no_dh
    - "B464"  # import_cryptography_no_aes
    - "B465"  # import_cryptography_no_aes_ctr
    - "B466"  # import_cryptography_no_aes_cbc
    - "B467"  # import_cryptography_no_aes_gcm
    - "B468"  # import_cryptography_no_ecdh
    - "B469"  # import_cryptography_no_ecdsa
    - "B470"  # import_cryptography_no_dsa
    - "B471"  # import_cryptography_no_dh
    - "B472"  # import_cryptography_no_aes
    - "B473"  # import_cryptography_no_aes_ctr
    - "B474"  # import_cryptography_no_aes_cbc
    - "B475"  # import_cryptography_no_aes_gcm
    - "B476"  # import_cryptography_no_ecdh
    - "B477"  # import_cryptography_no_ecdsa
    - "B478"  # import_cryptography_no_dsa
    - "B479"  # import_cryptography_no_dh
    - "B480"  # import_cryptography_no_aes
    - "B481"  # import_cryptography_no_aes_ctr
    - "B482"  # import_cryptography_no_aes_cbc
    - "B483"  # import_cryptography_no_aes_gcm
    - "B484"  # import_cryptography_no_ecdh
    - "B485"  # import_cryptography_no_ecdsa
    - "B486"  # import_cryptography_no_dsa
    - "B487"  # import_cryptography_no_dh
    - "B488"  # import_cryptography_no_aes
    - "B489"  # import_cryptography_no_aes_ctr
    - "B490"  # import_cryptography_no_aes_cbc
    - "B491"  # import_cryptography_no_aes_gcm
    - "B492"  # import_cryptography_no_ecdh
    - "B493"  # import_cryptography_no_ecdsa
    - "B494"  # import_cryptography_no_dsa
    - "B495"  # import_cryptography_no_dh
    - "B496"  # import_cryptography_no_aes
    - "B497"  # import_cryptography_no_aes_ctr
    - "B498"  # import_cryptography_no_aes_cbc
    - "B499"  # import_cryptography_no_aes_gcm
    - "B501"  # import_cryptography_no_ecdh
    - "B502"  # import_cryptography_no_ecdsa
    - "B503"  # import_cryptography_no_dsa
    - "B504"  # import_cryptography_no_dh
    - "B505"  # import_cryptography_no_aes
    - "B506"  # import_cryptography_no_aes_ctr
    - "B507"  # import_cryptography_no_aes_cbc

# Safety Configuration (Dependency Vulnerability Scanning)
safety:
  # Ignore certain vulnerabilities for specific reasons
  ignore:
    - "51608"  # Example: Temporary ignore for testing
    - "51609"  # Example: Temporary ignore for development
  
  # Database URL for vulnerability checking
  database: "https://pyup.io/safety-db/"

# Semgrep Configuration (Semantic Code Analysis)
semgrep:
  # Rules to include
  rules:
    - "security"
    - "owasp-top-ten"
    - "secrets"
  
  # Paths to exclude
  exclude:
    - "tests/"
    - "test/"
    - "build/"
    - "dist/"
    - "*.pyc"
    - "__pycache__/"
  
  # Patterns to detect
  patterns:
    # Secret detection
    - "password|token|secret|key|api[_-]?key|private[_-]?key"
    # SQL injection
    - "execute|exec|sp_?xp"
    # Path traversal
    - "\\.[\\/]|\\.[\\\\]"
    # Command injection
    - "\\|\\||\\&|;|`|\\$\\("

# Database Security Checks
database_security:
  # File patterns to scan for sensitive data
  sensitive_files:
    - "*.db"
    - "*.sqlite"
    - "*.sqlite3"
    - "*.json"
    - "*.config"
    - "*.ini"
  
  # Patterns that indicate sensitive information
  sensitive_patterns:
    - "password"
    - "token"
    - "secret"
    - "key"
    - "api_key"
    - "private_key"
    - "access_token"
    - "auth_token"
    - "session_key"
  
  # Required file permissions
  required_permissions:
    database_files: "600"  # Read/write for owner only
    config_files: "644"     # Read/write for owner, read for others
    executable_files: "755"  # Read/write/execute for owner, read/execute for others

# Token/Secret Detection
token_detection:
  # Common token patterns
  patterns:
    # API Keys
    - "sk-[a-zA-Z0-9]{20,}"
    - "AIza[A-Za-z0-9_-]{35}"
    - "ghp_[a-zA-Z0-9]{36}"
    - "glpat-[a-zA-Z0-9_-]{20,}"
    
    # Database connection strings
    - "mongodb://"
    - "postgresql://"
    - "mysql://"
    
    # Certificate patterns
    - "-----BEGIN CERTIFICATE-----"
    - "-----BEGIN PRIVATE KEY-----"
    - "-----BEGIN RSA PRIVATE KEY-----"
    
    # AWS patterns
    - "AKIA[0-9A-Z]{16}"
    - "ASIA[0-9A-Z]{16}"
    
    # Generic secret patterns
    - "secret[_-]?key"
    - "private[_-]?key"
    - "auth[_-]?token"
    - "access[_-]?token"

# Reporting Configuration
reporting:
  # Output formats
  formats:
    - "json"    # Machine readable
    - "sarif"    # Security findings format
    - "html"     # Human readable
  
  # Severity levels to report
  severity_levels:
    - "ERROR"    # Critical security issues
    - "WARNING"  # Potential security issues
    - "INFO"     # Security recommendations
  
  # Notification settings
  notifications:
    fail_on_error: true      # Fail build on critical issues
    fail_on_warning: false   # Continue build on warnings
    include_recommendations: true  # Include fix suggestions